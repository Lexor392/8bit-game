function initGameCanvas(t,e){var n=document.getElementById("gameCanvas");n.width=t,n.height=e,canvasW=t,canvasH=e,stage=new createjs.Stage("gameCanvas"),createjs.Touch.enable(stage),stage.enableMouseOver(20),stage.mouseMoveOutside=!0,createjs.Ticker.timingMode=createjs.Ticker.RAF_SYNCHED,createjs.Ticker.framerate=60,createjs.Ticker.addEventListener("tick",tick)}function buildGameCanvas(){canvasContainer=new createjs.Container,mainContainer=new createjs.Container,buttonLocalContainer=new createjs.Container,selectContainer=new createjs.Container,playersContainer=new createjs.Container,gameContainer=new createjs.Container,gameLivesContainer=new createjs.Container,gameCollectContainer=new createjs.Container,gameControlContainer=new createjs.Container,editMapContainer=new createjs.Container,mapContainer=new createjs.Container,mapWrapContainer=new createjs.Container,mapDrawContainer=new createjs.Container,mapIconsContainer=new createjs.Container,mapCollectContainer=new createjs.Container,mapPlayersContainer=new createjs.Container,mapMultiPlayersContainer=new createjs.Container,mapMultiLabelsContainer=new createjs.Container,mapLabelsContainer=new createjs.Container,resultContainer=new createjs.Container,touchContainer=new createjs.Container,touchMoveContainer=new createjs.Container,confirmContainer=new createjs.Container,bg=new createjs.Bitmap(loader.getResult("background")),bgP=new createjs.Bitmap(loader.getResult("backgroundP")),logo=new createjs.Bitmap(loader.getResult("logo")),logoP=new createjs.Bitmap(loader.getResult("logoP")),buttonStart=new createjs.Bitmap(loader.getResult("buttonStart")),centerReg(buttonStart),buttonLocal=new createjs.Bitmap(loader.getResult("buttonLocal")),centerReg(buttonLocal),buttonOnline=new createjs.Bitmap(loader.getResult("buttonOnline")),centerReg(buttonOnline),buttonLeft=new createjs.Bitmap(loader.getResult("buttonLeft")),centerReg(buttonLeft),buttonRight=new createjs.Bitmap(loader.getResult("buttonRight")),centerReg(buttonRight),buttonLeftSmall=new createjs.Bitmap(loader.getResult("buttonLeftSmall")),centerReg(buttonLeftSmall),buttonRightSmall=new createjs.Bitmap(loader.getResult("buttonRightSmall")),centerReg(buttonRightSmall),buttonSelect=new createjs.Bitmap(loader.getResult("buttonSelect")),centerReg(buttonSelect),gameStatusTxt=new createjs.Text,gameStatusTxt.font="50px upheaval_tt_brkregular",gameStatusTxt.color="#fff",gameStatusTxt.textAlign="center",gameStatusTxt.textBaseline="alphabetic",gameScoreTxt=new createjs.Text,gameScoreTxt.font="25px upheaval_tt_brkregular",gameScoreTxt.color="#fff",gameScoreTxt.textAlign="center",gameScoreTxt.textBaseline="alphabetic",gameScoreTxt.text="",gameLevelTxt=new createjs.Text,gameLevelTxt.font="25px upheaval_tt_brkregular",gameLevelTxt.color="#fff",gameLevelTxt.textAlign="center",gameLevelTxt.textBaseline="alphabetic",gameLevelTxt.text="",mapMask=new createjs.Shape;var t=1e3,e=40,n={regX:t/2,regY:0,height:e,width:t,count:2},a={static:{frames:[0],speed:.3},animate:{frames:[0,1],speed:.3}};brokenData=new createjs.SpriteSheet({images:[loader.getResult("itemBroken").src],frames:n,animations:a}),itemBroken=new createjs.Sprite(brokenData,"animate"),itemBroken.framerate=20;for(var o=0;o<4;o++)$.players[o]=new createjs.Container,$.players["name"+o]=new createjs.Text,$.players["name"+o].font="25px upheaval_tt_brkregular",$.players["name"+o].color="#fff",$.players["name"+o].textAlign=1==isEven(o)?"left":"right",$.players["name"+o].textBaseline="alphabetic",$.players["score"+o]=new createjs.Text,$.players["score"+o].font="25px upheaval_tt_brkregular",$.players["score"+o].color="#fff",$.players["score"+o].textAlign=1==isEven(o)?"left":"right",$.players["score"+o].textBaseline="alphabetic",$.players["icons"+o]=new createjs.Container,$.players["score"+o].y+=20,$.players["icons"+o].y+=40,$.players[o].addChild($.players["name"+o],$.players["score"+o],$.players["icons"+o]),playersContainer.addChild($.players[o]);buttonTouch=new createjs.Bitmap(loader.getResult("buttonTouch")),centerReg(buttonTouch),buttonTouchMove=new createjs.Bitmap(loader.getResult("buttonTouchMove")),centerReg(buttonTouchMove);var r=["Up","Right","Down","Left"],i=[0,90,180,270];touchMoveContainer.addChild(buttonTouch);for(o=0;o<r.length;o++)$.touch[r[o]]=new createjs.Bitmap(loader.getResult("buttonTouchPress")),centerReg($.touch[r[o]]),$.touch[r[o]].visible=!1,$.touch["arrow"+r[o]]=new createjs.Bitmap(loader.getResult("buttonTouchArrow")),centerReg($.touch["arrow"+r[o]]),$.touch[r[o]].regY=$.touch["arrow"+r[o]].regY=$.touch[r[o]].image.naturalHeight,$.touch["arrow"+r[o]].rotation=$.touch[r[o]].rotation=i[o],createHitarea($.touch["arrow"+r[o]]),touchMoveContainer.addChild($.touch[r[o]],$.touch["arrow"+r[o]]);touchMoveContainer.addChild(buttonTouchMove),touchContainer.addChild(touchMoveContainer),itemResult=new createjs.Bitmap(loader.getResult("itemPop")),itemResultP=new createjs.Bitmap(loader.getResult("itemPopP")),buttonContinue=new createjs.Bitmap(loader.getResult("buttonContinue")),centerReg(buttonContinue),resultShareTxt=new createjs.Text,resultShareTxt.font="35px upheaval_tt_brkregular",resultShareTxt.color="#fff",resultShareTxt.textAlign="center",resultShareTxt.textBaseline="alphabetic",resultShareTxt.text=textDisplay.share,resultTitleTxt=new createjs.Text,resultTitleTxt.font="60px upheaval_tt_brkregular",resultTitleTxt.color="#fff",resultTitleTxt.textAlign="center",resultTitleTxt.textBaseline="alphabetic",resultTitleTxt.text=textDisplay.resultTitle,resultDescTxt=new createjs.Text,resultDescTxt.font="65px upheaval_tt_brkregular",resultDescTxt.color="#43B3EA",resultDescTxt.textAlign="center",resultDescTxt.textBaseline="alphabetic",resultDescTxt.text="",buttonFacebook=new createjs.Bitmap(loader.getResult("buttonFacebook")),buttonTwitter=new createjs.Bitmap(loader.getResult("buttonTwitter")),buttonWhatsapp=new createjs.Bitmap(loader.getResult("buttonWhatsapp")),centerReg(buttonFacebook),createHitarea(buttonFacebook),centerReg(buttonTwitter),createHitarea(buttonTwitter),centerReg(buttonWhatsapp),createHitarea(buttonWhatsapp),buttonFullscreen=new createjs.Bitmap(loader.getResult("buttonFullscreen")),centerReg(buttonFullscreen),buttonSoundOn=new createjs.Bitmap(loader.getResult("buttonSoundOn")),centerReg(buttonSoundOn),buttonSoundOff=new createjs.Bitmap(loader.getResult("buttonSoundOff")),centerReg(buttonSoundOff),buttonSoundOn.visible=!1,buttonMusicOn=new createjs.Bitmap(loader.getResult("buttonMusicOn")),centerReg(buttonMusicOn),buttonMusicOff=new createjs.Bitmap(loader.getResult("buttonMusicOff")),centerReg(buttonMusicOff),buttonMusicOn.visible=!1,buttonExit=new createjs.Bitmap(loader.getResult("buttonExit")),centerReg(buttonExit),buttonSettings=new createjs.Bitmap(loader.getResult("buttonSettings")),centerReg(buttonSettings),createHitarea(buttonFullscreen),createHitarea(buttonSoundOn),createHitarea(buttonSoundOff),createHitarea(buttonMusicOn),createHitarea(buttonMusicOff),createHitarea(buttonExit),createHitarea(buttonSettings),optionsContainer=new createjs.Container,optionsContainer.addChild(buttonFullscreen,buttonSoundOn,buttonSoundOff,buttonMusicOn,buttonMusicOff,buttonExit),optionsContainer.visible=!1,itemExit=new createjs.Bitmap(loader.getResult("itemPop")),itemExitP=new createjs.Bitmap(loader.getResult("itemPopP")),buttonConfirm=new createjs.Bitmap(loader.getResult("buttonConfirm")),centerReg(buttonConfirm),buttonCancel=new createjs.Bitmap(loader.getResult("buttonCancel")),centerReg(buttonCancel),popTitleTxt=new createjs.Text,popTitleTxt.font="60px upheaval_tt_brkregular",popTitleTxt.color="#fff",popTitleTxt.textAlign="center",popTitleTxt.textBaseline="alphabetic",popTitleTxt.text=textDisplay.exitTitle,popDescTxt=new createjs.Text,popDescTxt.font="40px upheaval_tt_brkregular",popDescTxt.lineHeight=45,popDescTxt.color="#fff",popDescTxt.textAlign="center",popDescTxt.textBaseline="alphabetic",popDescTxt.text=textDisplay.exitMessage,confirmContainer.addChild(itemExit,itemExitP,popTitleTxt,popDescTxt,buttonConfirm,buttonCancel),confirmContainer.visible=!1,roomContainer=new createjs.Container,nameContainer=new createjs.Container,gameLogsTxt=new createjs.Text,gameLogsTxt.font="30px upheaval_tt_brkregular",gameLogsTxt.color="#ccc",gameLogsTxt.textAlign="center",gameLogsTxt.textBaseline="alphabetic",gameLogsTxt.text="",guide&&(guideline=new createjs.Shape,guideline.graphics.setStrokeStyle(2).beginStroke("red").drawRect((stageW-contentW)/2,(stageH-contentH)/2,contentW,contentH)),buttonLocalContainer.addChild(buttonLocal,buttonOnline),mainContainer.addChild(logo,logoP,buttonStart,buttonLocalContainer),selectContainer.addChild(buttonSelect),mapWrapContainer.addChild(mapDrawContainer,mapIconsContainer,mapCollectContainer,mapPlayersContainer,mapLabelsContainer),mapContainer.addChild(mapWrapContainer,mapMultiPlayersContainer,mapMultiLabelsContainer,itemBroken,editMapContainer),gameContainer.addChild(gameStatusTxt,gameScoreTxt,gameLevelTxt,gameLivesContainer,gameCollectContainer,playersContainer,touchContainer),resultContainer.addChild(itemResult,itemResultP,buttonContinue,resultTitleTxt,resultDescTxt),shareEnable&&resultContainer.addChild(resultShareTxt,buttonTwitter),canvasContainer.addChild(bg,bgP,mainContainer,mapContainer,selectContainer,gameContainer,gameLogsTxt,resultContainer,confirmContainer,optionsContainer,buttonSettings,guideline),stage.addChild(canvasContainer),changeViewport(viewport.isLandscape),resizeGameFunc()}function changeViewport(t){t?(stageW=landscapeSize.w,stageH=landscapeSize.h,contentW=landscapeSize.cW,contentH=landscapeSize.cH):(stageW=portraitSize.w,stageH=portraitSize.h,contentW=portraitSize.cW,contentH=portraitSize.cH),gameCanvas.width=stageW,gameCanvas.height=stageH,canvasW=stageW,canvasH=stageH,changeCanvasViewport()}function changeCanvasViewport(){if(null!=canvasContainer)if(viewport.isLandscape){bg.visible=!0,bgP.visible=!1,logo.visible=!0,logoP.visible=!1,buttonStart.x=canvasW/2,buttonStart.y=canvasH/100*75,buttonLocal.x=canvasW/2-120,buttonLocal.y=canvasH/100*75,buttonOnline.x=canvasW/2+120,buttonOnline.y=canvasH/100*75;var t=350,e=300;buttonLeft.x=canvasW/2-t,buttonLeft.y=canvasH/100*50,buttonRight.x=canvasW/2+t,buttonRight.y=canvasH/100*50,buttonLeftSmall.x=canvasW/2-e,buttonLeftSmall.y=canvasH/100*55,buttonRightSmall.x=canvasW/2+e,buttonRightSmall.y=canvasH/100*55,buttonSelect.x=canvasW/2,buttonSelect.y=canvasH/100*75,itemResult.visible=!0,itemResultP.visible=!1,buttonFacebook.x=canvasW/100*44,buttonFacebook.y=canvasH/100*55,buttonTwitter.x=canvasW/2,buttonTwitter.y=canvasH/100*55,buttonWhatsapp.x=canvasW/100*56,buttonWhatsapp.y=canvasH/100*55,buttonContinue.x=canvasW/2,buttonContinue.y=canvasH/100*68,resultShareTxt.x=canvasW/2,resultShareTxt.y=canvasH/100*49,resultTitleTxt.x=canvasW/2,resultTitleTxt.y=canvasH/100*35,resultDescTxt.x=canvasW/2,resultDescTxt.y=canvasH/100*42,itemExit.visible=!0,itemExitP.visible=!1,buttonConfirm.x=canvasW/2-110,buttonConfirm.y=canvasH/100*68,buttonCancel.x=canvasW/2+110,buttonCancel.y=canvasH/100*68,popTitleTxt.x=canvasW/2,popTitleTxt.y=canvasH/100*35,popDescTxt.x=canvasW/2,popDescTxt.y=canvasH/100*45,$("#roomWrapper").removeClass("forPortrait"),$("#notificationHolder").removeClass("forPortrait"),$("#roomlists").attr("size",10),$("#namelists").attr("size",10),$("#roomLogs").attr("rows",10)}else{bg.visible=!1,bgP.visible=!0,logo.visible=!1,logoP.visible=!0,buttonStart.x=canvasW/2,buttonStart.y=canvasH/100*75,buttonLocal.x=canvasW/2,buttonLocal.y=canvasH/100*73,buttonOnline.x=canvasW/2,buttonOnline.y=canvasH/100*85;t=250,e=200;buttonLeft.x=canvasW/2-t,buttonLeft.y=canvasH/100*50,buttonRight.x=canvasW/2+t,buttonRight.y=canvasH/100*50,buttonLeftSmall.x=canvasW/2-e,buttonLeftSmall.y=canvasH/100*55,buttonRightSmall.x=canvasW/2+e,buttonRightSmall.y=canvasH/100*55,buttonSelect.x=canvasW/2,buttonSelect.y=canvasH/100*85,itemResult.visible=!1,itemResultP.visible=!0,buttonFacebook.x=canvasW/100*39,buttonFacebook.y=canvasH/100*54,buttonTwitter.x=canvasW/2,buttonTwitter.y=canvasH/100*54,buttonWhatsapp.x=canvasW/100*61,buttonWhatsapp.y=canvasH/100*54,buttonContinue.x=canvasW/2,buttonContinue.y=canvasH/100*64,resultShareTxt.x=canvasW/2,resultShareTxt.y=canvasH/100*49,resultTitleTxt.x=canvasW/2,resultTitleTxt.y=canvasH/100*38,resultDescTxt.x=canvasW/2,resultDescTxt.y=canvasH/100*45,itemExit.visible=!1,itemExitP.visible=!0,buttonConfirm.x=canvasW/2-110,buttonConfirm.y=canvasH/100*64,buttonCancel.x=canvasW/2+110,buttonCancel.y=canvasH/100*64,popTitleTxt.x=canvasW/2,popTitleTxt.y=canvasH/100*38,popDescTxt.x=canvasW/2,popDescTxt.y=canvasH/100*48,$("#roomWrapper").addClass("forPortrait"),$("#notificationHolder").addClass("forPortrait"),$("#roomlists").attr("size",8),$("#namelists").attr("size",8),$("#roomLogs").attr("rows",6)}}function resizeCanvas(){if(null!=canvasContainer){buttonSettings.x=canvasW-offset.x-50,buttonSettings.y=offset.y+45;var t=60,e=0;"game"!=curPage?(buttonExit.visible=!1,buttonSoundOn.x=buttonSoundOff.x=buttonSettings.x,buttonSoundOn.y=buttonSoundOff.y=buttonSettings.y+t,buttonSoundOn.x=buttonSoundOff.x,buttonSoundOn.y=buttonSoundOff.y=buttonSettings.y+t,"undefined"!=typeof buttonMusicOn?(buttonMusicOn.x=buttonMusicOff.x=buttonSettings.x,buttonMusicOn.y=buttonMusicOff.y=buttonSettings.y+2*t,buttonMusicOn.x=buttonMusicOff.x,buttonMusicOn.y=buttonMusicOff.y=buttonSettings.y+2*t,e=2):e=1,buttonFullscreen.x=buttonSettings.x,buttonFullscreen.y=buttonSettings.y+t*(e+1)):(buttonExit.visible=!0,buttonSoundOn.x=buttonSoundOff.x=buttonSettings.x,buttonSoundOn.y=buttonSoundOff.y=buttonSettings.y+t,buttonSoundOn.x=buttonSoundOff.x,buttonSoundOn.y=buttonSoundOff.y=buttonSettings.y+t,"undefined"!=typeof buttonMusicOn?(buttonMusicOn.x=buttonMusicOff.x=buttonSettings.x,buttonMusicOn.y=buttonMusicOff.y=buttonSettings.y+2*t,buttonMusicOn.x=buttonMusicOff.x,buttonMusicOn.y=buttonMusicOff.y=buttonSettings.y+2*t,e=2):e=1,buttonFullscreen.x=buttonSettings.x,buttonFullscreen.y=buttonSettings.y+t*(e+1),buttonExit.x=buttonSettings.x,buttonExit.y=buttonSettings.y+t*(e+2)),mapSettings.screenControlSide?(touchMoveContainer.x=canvasW-offset.x-130,touchMoveContainer.y=canvasH-offset.y-130):(touchMoveContainer.x=offset.x+130,touchMoveContainer.y=canvasH-offset.y-130),resizeMap(),resizeSocketLog()}}function removeGameCanvas(){stage.autoClear=!0,stage.removeAllChildren(),stage.update(),createjs.Ticker.removeEventListener("tick",tick),createjs.Ticker.removeEventListener("tick",stage)}function tick(t){updateGame(),stage.update(t)}function centerReg(t){t.regX=t.image.naturalWidth/2,t.regY=t.image.naturalHeight/2}function createHitarea(t){t.hitArea=new createjs.Shape((new createjs.Graphics).beginFill("#000").drawRect(0,0,t.image.naturalWidth,t.image.naturalHeight))}var stage,canvasContainer,mainContainer,gameContainer,instructionContainer,resultContainer,moveContainer,confirmContainer,guideline,bg,logo,buttonOk,result,shadowResult,buttonReplay,buttonFacebook,buttonTwitter,buttonWhatsapp,buttonFullscreen,buttonSoundOn,buttonSoundOff,canvasW=0,canvasH=0,guide=!1;$.touch={},$.objects={},$.players={};